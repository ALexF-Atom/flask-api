<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.4/css/bootstrap.min.css" integrity="2hfp1SzUoho7/TsGGGDaFdsuuDL0LX2hnUp6VkX3CUQ2K4K+xjboZdsXyp4oUHZj" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.3.5/dist/alpine.min.js" defer="defer">
	</script>
	<title>{{title}}</title>
</head>
<body>


<div x-data="init()">
	<div class="container justify-center">
		<h1>{{message}}</h1>
		<form class="form form-group" autocomplete="off">
			<input  x-on:keyup="getData" x-model="inputValue" >
			<button class="btn btn-primary" type="button" @click="getCompany">Ok</button>
			<div class="autocomplete-items" id="13-autocomplete-list">
				<template x-for="(data, index) in dataFrame" :key="index">
					<div x-text="dataText([index, data])"
						 @click="inputValue=getIndex($event)"
						 x-bind:index="index">
					</div>
				</template>
			</div>
		</form>

		<div x-show="isShowCompany">
			<button @click="show=!show" x-text="show ? 'Скрыть': 'Показать'"></button>
			<div x-show="show">
				<template x-for="item in dataCompany" :key="item">
					<p x-text="dataText(item)"></p>
				</template>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
function init(){ return {
	dataFrame: [],
	inputValue: "",
	tempValue: "",
	dataCompany: [],
	show: false,
	isShowCompany: false,
	getIndex: function(e){
		this.dataFrame = []
		return e.target.getAttribute("index")
	},
	getCompany: function(){
		this.dataFetch("{{url_for('.api_company')}}"+"?"+this.inputValue.toUpperCase())
		.then((data)=>{
			this.isShowCompany = true
			this.dataCompany = Object.entries(data)})
		},
	dataFetch: function(url) {
		return fetch(url).then((response) => {return response.json()})
		},
	dataText: function(item){
		return item[0]+": "+item[1]
		},

	getData: function(e){
		if (!this.inputValue) this.dataFrame = []
		if (this.inputValue.length == 1 && this.tempValue != this.inputValue ){
			this.tempValue = this.inputValue
			this.isShowCompany = false
			this.dataFetch("{{url_for('.api_page')}}"+"?"+this.inputValue.toUpperCase())
				.then((data) => { this.dataFrame = new Map(Object.entries(data))})
			}
		},
	}
}


</script>

</body>
</html>
